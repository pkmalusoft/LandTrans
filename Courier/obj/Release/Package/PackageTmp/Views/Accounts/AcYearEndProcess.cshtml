@model LTMSV2.Models.YearEndProcessSearch

@{
    Layout = "~/Views/Shared/_TrueBookMstr.cshtml";
    var i = 0;
    var isadd = true;
    var ismodify = true;
    var isdelete = true;    
    string path = Request.Url.AbsolutePath.ToLower();

    if (Convert.ToInt32(Session["UserRoleID"]) > 1)
    {
        LTMSV2.Models.SourceMastersModel obj = new LTMSV2.Models.SourceMastersModel();
        isadd = obj.GetAddpermission(Convert.ToInt32(Session["UserRoleID"]), path);
        ismodify = obj.GetModifypermission(Convert.ToInt32(Session["UserRoleID"]), path);
        isdelete = obj.GetDeletepermission(Convert.ToInt32(Session["UserRoleID"]), path);

    }
}

<style>
    #dataTables-example .form-control, input {
        height: 30px !important;
        border-radius: 10px !important;
        border: 1px solid #ccc;
        margin-bottom: 0;
    }
</style>
<script src="~/Content/NewCSS/plugins/jQuery/moment.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/js/bootstrap-datetimepicker.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/css/bootstrap-datetimepicker.min.css" />

<script type="text/javascript">

    function orderrownumber() {
        var itemcount = $('#dataTables-example > tbody > tr').length;
        var rowindex = 1;
        var i = 0;
        var sumdebit = 0;
        var sumcredit = 0;
        for (i = 0; i < itemcount; i++) {
            var IsDeleted = $('#hdndel_' + i).val();
            if (IsDeleted != "true") {
                $('#row_' + i).html(rowindex);
                rowindex++;

                var Amount = 0;
                if (parseFloat($('#txtDebit_' + i).val()) > 0) {
                    Amount = parseFloat($('#txtDebit_' + i).val());
                    sumdebit = sumdebit + Amount;
                }
                else {
                    AccNature = "Cr";
                    Amount = parseFloat($('#txtCredit_' + i).val());
                    sumcredit = sumcredit + Amount;
                }
            }
            if (i == (itemcount - 1))
                {
                $('#Debit').val(parseFloat(sumdebit).toFixed(2));
                $('#spantotaldebit').html(parseFloat(sumdebit).toFixed(2));
                $('#spantotalcredit').html(parseFloat(sumcredit).toFixed(2));
                $('#Credit').val(parseFloat(sumcredit).toFixed(2));
            }
        }

    }

    function checktotal() {
        var itemcount = $('#dataTables-example > tbody > tr').length;
        var rowindex = 1;
        var i = 0;
        var sumdebit = 0;
        var sumcredit = 0;
        for (i = 0; i < itemcount; i++) {
            var IsDeleted = $('#hdndel_' + i).val();
            if (IsDeleted != "true") {
                rowindex++;

                var Amount = 0;
                if (parseFloat($('#txtDebit_' + i).val()) > 0) {
                    Amount = parseFloat($('#txtDebit_' + i).val());
                    sumdebit = sumdebit + Amount;
                }
                else {
                    AccNature = "Cr";
                    Amount = parseFloat($('#txtCredit_' + i).val());
                    sumcredit = sumcredit + Amount;
                }
            }
            if (i == (itemcount - 1)) {
                $('#Debit').val(parseFloat(sumdebit).toFixed(2));
                $('#spantotaldebit').html(parseFloat(sumdebit).toFixed(2));
                $('#spantotalcredit').html(parseFloat(sumcredit).toFixed(2));

                var balance = parseFloat(sumdebit) - parseFloat(subcredit);
                $('#spanbalance').html(parseFloat(balance).toFixed(2));
                $('#Credit').val(parseFloat(sumcredit).toFixed(2));
            }
        }

    }
    function process() {
        $('#confirmationpopup').modal('hide');
        $('#loaderpopup').modal('show')
        $.ajax({
            contentType: 'application/json;charset=utf-8',
            type: "POST",
            dataType: 'json',
            url: "/Accounts/SaveYearEndProcessing",
            //data: items,
            success: function (data) {
                if (data.status == "ok") {
                    $('#loaderpopup').modal('hide')
                    setTimeout(function () {
                        window.location.reload();
                    }, 500)
                    $.notify(data.message, "success");

                } else {
                    $.notify(data.message, "error");
                }
            }
        });             
    }
    $(document).ready(function () {
                
        $("#btnsave").click(function () {
            debugger;
            $('#confirmationpopup').modal('show');
                   
        });

        $("#btnsearch").click(function () {
            debugger;
            EnableAdd();

        });
        

        $('#btncancel').click(function () {
            location.reload();
        });



    });

    function setThreeNumberDecimal(obj) {
        $(obj).val(parseFloat($(obj).val()).toFixed(2));
    }
</script>


<div class="row no-margin">
    @{ Html.RenderAction("AcYearEndProcessSearch", "Accounts");}
</div>

<section class="">
    @if (TempData["SuccessMsg"] != null)
    {
        <script type="text/javascript">
                  $(document).ready(function () {
                      $.notify("@TempData["SuccessMsg"]", "success");
                 });
        </script>
    }

    @using (Html.BeginForm())
    {
        @Html.ValidationSummary(true)

        if (@Model.ProcessType == "A")
        {
            <div class="table-responsive tblbackground" style="padding: 15px;margin-top: 20px;max-height:600px;overflow-y: scroll;overflow-x:scroll" id="listContainer">
                @{Html.RenderPartial("AcYearEndProcessItemList", Model);}
            </div>
                    }
        else if (@Model.ProcessType == "C" || @Model.ProcessType == "L")
                    {
            <div class="table-responsive tblbackground" style="padding: 15px;margin-top: 20px;max-height:600px;overflow-y: scroll;overflow-x:scroll" id="listContainer">
                @{Html.RenderPartial("AcYearEndInvCustomer", Model);}
            </div>
        }
        else if (@Model.ProcessType == "S" || Model.ProcessType=="F")
        {
            <div class="table-responsive tblbackground" style="padding: 15px;margin-top: 20px;max-height:600px;overflow-y: scroll;overflow-x:scroll" id="listContainer">
                @{Html.RenderPartial("AcYearEndInvSupplier", Model);}
            </div>
        }
        else if (@Model.ProcessType == "Y")
        {
            <div class="row">
                <div class="col-md-6">
                    <div class="table-responsive tblbackground" style="padding: 15px;margin-top: 20px;max-height:600px;overflow-y: scroll;overflow-x:scroll">
                        @{Html.RenderPartial("AcYearEndIncomeExpense", Model);}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="table-responsive tblbackground" style="padding: 15px;margin-top: 20px;max-height:600px;overflow-y: scroll;overflow-x:scroll">
                        @{Html.RenderPartial("AcYearEndPL", Model);}
                    </div>
                </div>
            </div>
        }



    }
</section>
<div class="modal fade" id="loaderpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="LoaderModalLabel">
                    Year End Processing
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="text-align:center">
                        <h2>Processing...</h2>
                        <img src="~/Content/img/loading-gif-free-download-6.gif" id="imgloader" class="" style="padding-left:15px;height:60px;width:60px;" />
                    </div>
                </div>
            </div>
            @*<div class="modal-footer" style="padding-top: 5px">
                    <button type="button" class="btn btn-primary" onclick="savefixation()">Save</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="confirmationpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="LoaderModalLabel">
                    Year End Processing
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="text-align:center">
                        <h3>@Model.Comments </h3>
                        <h2 style="color:red!important">Are you sure to Process?</h2>                        
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding-top: 5px">
                    <button type="button" class="btn btn-primary" onclick="process()">Process</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>