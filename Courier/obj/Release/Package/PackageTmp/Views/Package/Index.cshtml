
@{

    ViewBag.Title = "Add Packages";
    Layout = "~/Views/Shared/_TrueBookMstr.cshtml";
}


<section class="content-header">
    <h1 class="headingfont">Package</h1>

</section>

<div class="row">
    <div class="col-lg-12 mt-2 mb-2 text-right">
        <button id="btnAddNewPackages" type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal" data-target="#modelPackages">Add</button>
        <!-- Modal -->
        <div class="modal fade" id="modelPackages" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #f5f5f5;">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">
                            Package
                        </h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group text-left">
                            <label for="exampleFormControlInput1">Packages Type</label>
                            <input type="text" class="form-control" id="txtPackageType" placeholder="Package Type" style="text-transform:capitalize">
                        </div>

                        <div class="form-group text-left">
                            <label for="exampleFormControlInput1">Description</label>
                            <textarea id="txtDescription" class="form-control" style="text-transform:capitalize"></textarea>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="add-Packages btn btn-primary ngadd">Save</button>
                        <button type="button" id="btn-cancel" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="row">

            <div class="col-lg-12 pb-5">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered nowrap" style="width:100%">
                        <thead>
                            <tr>
                                <th>Package Type</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    var g_ManagePackages = {

        PackageID: '', PackageType: '', PackageDescription: ''

    }

    $(document).ready(function () {

        $(document).on('click', '.ngadd', function () {

            var btn = $(this);
            var txt = $(this).text();
            $('input').css('border', '');
            $('textarea').css('border', '');
            $('select').css('border', '');
            $('.ngerr').remove();
            $('.input-group').css('border', '');
            $('.ngerr').remove();

            var ManagePackages = {};
            ManagePackages.PackageID = "#";
            ManagePackages.PackageType = $('#txtPackageType').val();
            ManagePackages.PackageDescription = $('#txtDescription').val();


            if ($.trim(ManagePackages.PackageType) == '') {
                $('#txtPackageType').focus().css('border', '2px solid red').after('<span class="text-danger ngerr">Required</span>');
                return;
            }

            if ($.trim(ManagePackages.PackageDescription) == '') {
                $('#txtDescription').focus().css('border', '2px solid red').after('<span class="text-danger ngerr">Required</span>');
                return;
            }


            var Itn = $('#txtPackageType').val();
            Itn = Itn.toLowerCase().replace(/\b[a-z]/g, function (letter) {
                return letter.toUpperCase();
            });
            ManagePackages.PackageType = Itn;


            var de = $('#txtDescription').val();
            de = de.toLowerCase().replace(/\b[a-z]/g, function (letter) {
                return letter.toUpperCase();
            });

            ManagePackages.PackageDescription = de;


            if (!$(btn).hasClass('disabled')) {
                $(btn).addClass('disabled').text('Saving...');
                $.ajax({
                    type: "Post",
                    url: "/Package/ManageInsertPackages",
                    data: "{o:" + JSON.stringify(ManagePackages) + "}",
                    contentType: "application/json;charset=utf-8;",
                    dataType: "json",
                    success: function (data) {
                        var str = data;
                        var val = str.search("-");
                        if (val > 0) {
                            $(btn).text(txt).removeClass('disabled');
                            alert('Record is Successfully Saved...!');
                            $('#txtPackageType').val('');
                            $('#txtDescription').val('');
                            $('#modelPackages').modal('hide');
                            window.location.reload();
                            Get_ManagePackages(g_ManagePackages);
                        }
                        else {
                            alert(data);
                            $(btn).text(txt).removeClass('disabled');
                        }
                    },
                    error: function (data) {

                        alert('error:' + Error);
                        $(btn).text(txt).removeClass('disabled');
                    }
                });
            }
        });


        $(document).on('click', '.ngupdate', function () {

            var btn = $(this);
            var txt = $(this).text();
            $('input').css('border', '');
            $('textarea').css('border', '');
            $('select').css('border', '');
            $('.ngerr').remove();
            $('.input-group').css('border', '');
            $('.ngerr').remove();

            var ManagePackages = {};
            ManagePackages.PackageID = "#";
            ManagePackages.PackageType = $('#txtPackageType').val();
            ManagePackages.PackageDescription = $('#txtDescription').val();


            if ($.trim(ManagePackages.PackageType) == '') {
                $('#txtPackageType').focus().css('border', '2px solid red').after('<span class="text-danger ngerr">Required</span>');
                return;
            }

            if ($.trim(ManagePackages.PackageDescription) == '') {
                $('#txtDescription').focus().css('border', '2px solid red').after('<span class="text-danger ngerr">Required</span>');
                return;
            }

            var Itn = $('#txtPackageType').val();
            Itn = Itn.toLowerCase().replace(/\b[a-z]/g, function (letter) {
                return letter.toUpperCase();
            });
            ManagePackages.PackageType = Itn;


            var de = $('#txtDescription').val();
            de = de.toLowerCase().replace(/\b[a-z]/g, function (letter) {
                return letter.toUpperCase();
            });
            ManagePackages.PackageDescription = de;


            if ($(btn).hasClass('ngupdate')) {
                ManagePackages.PackageID = $(btn).attr('did');
            }

            if (!$(btn).hasClass('disabled')) {
                $(btn).addClass('disabled').text('Saving...');
                $.ajax({
                    type: "Post",
                    url: "/Package/ManageUpdatePackages",
                    data: "{o:" + JSON.stringify(ManagePackages) + "}",
                    contentType: "application/json;charset=utf-8;",
                    dataType: "json",
                    success: function (data) {
                        var str = data;
                        var val = str.search("-");
                        if (val > 0) {
                            $(btn).text(txt).removeClass('disabled');
                            alert('Record is Successfully Updated...!');
                            $('#txtPackageType').val('');
                            $('#txtDescription').val('');
                            $('#modelPackages').modal('hide');
                            window.location.reload();
                            Get_ManagePackages(g_ManagePackages);
                        }
                        else {
                            alert(data);
                            $(btn).text(txt).removeClass('disabled');
                        }
                    },
                    error: function (data) {

                        alert('error:' + Error);
                        $(btn).text(txt).removeClass('disabled');
                    }
                });
            }
        });


        $('#btnAddNewPackages').click(function () {

            $('.ngerr').remove();
            $('input').css('border', '');
            $('textarea').css('border', '');
            $('select').css('border', '');
            $('#txtPackageType').val('');
            $('#txtDescription').val('');
            $('.add-Packages').addClass('ngadd');
            $('.ngadd').text('Save').removeClass('ngupdate').removeAttr('did');

        });


        $(document).on('click', '.ngedit', function () {
            $('.ngerr').remove(); $('.pgmsg').text('');
            $('select').css('border', '');
            $('input').css('border', '');
            $('textarea').css('border', '');
            $('.ngadd').text('Update');
            var Id = $(this).attr('did');
            var row = $(this).closest('tr');
            var l_obj = '';
            l_obj = JSON.parse($(".ngedit").closest("tr").attr("data-obj").replace(/\~/g, "'"));
            l_obj = l_obj.find(a => (a.PackageID == Id));

            $('#txtPackageType').val(l_obj.PackageType);
            $('#txtDescription').val(l_obj.PackageDescription);

            $('.add-Packages').addClass('ngupdate').attr('did', Id);
            $('.add-Packages').removeClass('ngadd');
        });

        $('#btn-cancel').click(function () {
            $('#modelPackages').modal('hide');
        });


        $(document).on('click', '.ngdelete', function () {
            var btn = $(this);
            var txt = $(this).html();
            var ID = $(this).attr('did');

            var ManagePackages = {};
            ManagePackages.PackageID = ID;
            ManagePackages.PackageType = "#";
            ManagePackages.PackageDescription = "#";


            if (confirm('Are you sure want to delete ?')) {
                if (!$(btn).hasClass('disabled')) {
                    $(btn).text('...').addClass('disabled');
                    $.ajax({
                        type: "POST",
                        url: "/Admin/ManageDeletePackages",
                        data: "{o:" + JSON.stringify(ManagePackages) + "}",
                        contentType: "application/json;charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            $(btn).closest('tr').fadeOut(300, function () {
                                $(btn).closest('tr').remove();
                            });
                            window.location.reload();
                        },
                        error: function (data) {
                            alert('error :' + Error);
                            $(btn).html(txt).removeClass('disabled');
                        }
                    })
                }
            }
        });

        Get_ManagePackages(g_ManagePackages);

        function Get_ManagePackages(obj) {
            $.ajax({
                type: "Post",
                url: "/Package/GetPackages",
                data: "{o: " + JSON.stringify(obj) + "}",
                contentType: "application/json;charset=utf-8;",
                dataType: "json",
                success: function (res) {
                    if (res.length > 0) {
                        $('#example tbody').empty();

                        $.each(res, function (i, v) {
                            var editbtn = '<i class="fa fa-pencil ngedit" title="Edit" style="color:#0ad251;" data-toggle="modal" data-target="#modelPackages" did="' + v.PackageID + '"></i>';
                            var delbtn = '<i class="fa fa-times ngdelete" title="Delete" style="color:#f43a59;" did="' + v.PackageID + '"></i>';
                            var row = "<tr data-obj='" + JSON.stringify(res).replace(/\'/g, "~") + "'><td>" + v.PackageType + "</td><td>" + v.PackageDescription + "</td><td>" + editbtn + '&nbsp;&nbsp;' + delbtn + "</td></tr>";
                            $('#example tbody').append(row);
                        });
                        $('#example').DataTable();
                    }
                    else {
                        $('#example tbody').empty();
                        var row = '<tr><td colspan="3">No Record Found.</td></tr>';
                        $('#example tbody').append(row);
                    }
                },
                error: function (res) {
                    alert(res.responseText);
                    $('#example tbody').empty();
                    var row = '<tr><td colspan="3">Connection Error..</td></tr>';
                    $('#example tbody').append(row);
                }
            });
        }
    });
</script>
